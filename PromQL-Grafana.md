"–†–≤–∞–Ω—ã–µ" –≥—Ä–∞—Ñ–∏–∫–∏ –≤ Grafana (–∫–∞–∫ –≤–∏–¥–Ω–æ –Ω–∞ —Ç–≤–æ–µ–π –æ—Ä–∞–Ω–∂–µ–≤–æ–π –ª–∏–Ω–∏–∏) –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–∏—á–∏–Ω–∞–º–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **VictoriaMetrics** –∫–∞–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç—Ä–∏–∫. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –ø–æ —à–∞–≥–∞–º, –ø–æ—á–µ–º—É —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å, –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

---

### **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**

#### 1. **–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö (Gaps)**
**–ü—Ä–∏—á–∏–Ω–∞:** –î–∞–Ω–Ω—ã–µ –ø–æ –º–µ—Ç—Ä–∏–∫–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–π PromQL-–∑–∞–ø—Ä–æ—Å –≤ Grafana:  
  ```promql
  rate(your_metric_name[1m])
  ```
  –î–æ–±–∞–≤—å `step=10s` –∏ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ "–¥—ã—Ä—ã" ‚Äî –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å, –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –ø–æ—Å—Ç—É–ø–∞–ª–∏.

- –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
  ```promql
  absent_over_time(your_metric_name[1m])
  ```
  –∏–ª–∏
  ```promql
  count_over_time(your_metric_name[1m])
  ```

#### 2. **–ù–µ—Ä–µ–≥—É–ª—è—Ä–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫**
**–ü—Ä–∏—á–∏–Ω–∞:** –ú–µ—Ç—Ä–∏–∫–∞ –ø—É—à–∏—Ç—Å—è/—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–µ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥), –∞ —Å–ª—É—á–∞–π–Ω–æ.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –í—ã–ø–æ–ª–Ω–∏ `timestamp(your_metric_name)` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–∏, –∫–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è.
- –ò—Å–ø–æ–ª—å–∑—É–π `changes(your_metric_name[5m])` ‚Äî –µ—Å–ª–∏ –º–∞–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –º–µ—Ç—Ä–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å "—Ä–µ–¥–∫–æ–π".

#### 3. **–ü—Ä–æ–±–ª–µ–º—ã —Å push (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å `vmagent`)**
**–ü—Ä–∏—á–∏–Ω–∞:** –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è push (—á–µ—Ä–µ–∑ `vmagent` –∏–ª–∏ `pushgateway`), –º–æ–≥—É—Ç –±—ã—Ç—å —Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, —Ç–∞–π–º–∞—É—Ç—ã –∏–ª–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –º–µ—Ç—Ä–∏–∫.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –õ–æ–≥–∏ `vmagent`, `prometheus` –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è.
- –ú–µ—Ç—Ä–∏–∫–∞ `up{job="..."}` ‚Äî –µ—Å–ª–∏ `up=0`, –∑–Ω–∞—á–∏—Ç –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ –º–µ—Ç—Ä–∏–∫—É –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ endpoints –¥–æ—Å—Ç—É–ø–Ω—ã.

#### 4. **–û—à–∏–±–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–±–æ—Ä–∞ (Prometheus / Exporter)**
**–ü—Ä–∏—á–∏–Ω–∞:** –≠–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã –º–æ–≥—É—Ç –Ω–µ –≤—ã–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ—Ü–µ—Å—Å —É–ø–∞–ª, —Ä–µ—Å—Ç–∞—Ä—Ç–Ω—É–ª—Å—è, –∏–ª–∏ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç —Å–æ–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏).

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- `up{job="your_job"}` ‚Äî –ø—Ä–æ–≤–µ—Ä—å, —Å—Ç–∞–±–∏–ª—å–Ω–æ –ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω —ç–∫—Å–ø–æ—Ä—Ç—ë—Ä.
- –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–æ–≤ –∏ `vmagent`.

#### 5. **–û—à–∏–±–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è (VictoriaMetrics)**
**–ü—Ä–∏—á–∏–Ω–∞:** –ï—Å–ª–∏ VictoriaMetrics –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞, –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è/–∑–∞–¥–µ—Ä–∂–∫–∞ ingestion –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å retention.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –í–∫–ª—é—á–∏ –º–µ—Ç—Ä–∏–∫–∏ VictoriaMetrics:
  - `vm_ingest_rows_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫.
  - `vm_ingest_rows_dropped_total` ‚Äî **–ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏** (–æ—á–µ–Ω—å –≤–∞–∂–Ω–æ!).
  - `vm_ingest_rows_per_second` ‚Äî —Ç–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å.
- –õ–æ–≥–∏ VictoriaMetrics ‚Äî –∏—â–∏ `error`, `drop`, `queue full`, `slow ingestion`.

---

### **–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å**

#### A. **–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫**
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä —Ä–∞–∑ –≤ 15 —Å–µ–∫—É–Ω–¥.
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ scrape-—Ç–∞–π–º–∏–Ω–≥ –æ–¥–∏–Ω–∞–∫–æ–≤ —É –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

#### B. **–£–≤–µ–ª–∏—á—å —á–∞—Å—Ç–æ—Ç—É scrape –≤ `vmagent` –∏–ª–∏ `prometheus.yml`**
```yaml
scrape_interval: 15s
scrape_timeout: 10s
```

#### C. **–ù–∞—Å—Ç—Ä–æ–π–∫—É `minStep` –≤ Grafana**
- –ü–µ—Ä–µ–π–¥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–Ω–µ–ª–∏ Grafana.
- –£—Å—Ç–∞–Ω–æ–≤–∏ `Min step` –≤—Ä—É—á–Ω—É—é, –Ω–∞–ø—Ä–∏–º–µ—Ä `15s`.
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏ –∏–∑-–∑–∞ "—Å–ª–∏—à–∫–æ–º –ø–ª–æ—Ç–Ω–æ–π" –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.

#### D. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ retention & ingestion limits –≤ VictoriaMetrics**
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–µ—Ç –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ ingestion.
- –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: disk I/O –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º.
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Ç–µ—Ä–Ω–∞—è VictoriaMetrics ‚Äî –ø—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É ingestion –ø–æ `vmstorage`.

#### E. **–î–æ–±–∞–≤—å `fill_null()` –≤ Grafana (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PromQL/VMQL)**
- –í VMQL –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
  ```promql
  your_metric_name or vector(0)
  ```
  –∏–ª–∏ —Å `+ fill(...)` –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è VMAgent ‚Üí VMAggregate ‚Üí Grafana.

---

### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**

- **`vmui` (VictoriaMetrics UI):** –ø–µ—Ä–µ–π–¥–∏ –Ω–∞ `http://<vm-host>:8428/vmui`, –≤—ã–ø–æ–ª–Ω–∏ –∑–∞–ø—Ä–æ—Å `your_metric_name` –∏ –≤–∫–ª—é—á–∏ –≥—Ä–∞—Ñ–∏–∫.
- **`vmctl` –∏–ª–∏ `vmagent` with `-remoteWrite.url=...`:** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ ingestion.

---

### **–†–µ–∑—é–º–µ**

| –ü—Ä–∏—á–∏–Ω–∞                              | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å                              | –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å                         |
|--------------------------------------|--------------------------------------------|----------------------------------------|
| –ü—Ä–æ–ø—É—Å–∫–∏ –¥–∞–Ω–Ω—ã—Ö                      | `absent_over_time`, `count_over_time`      | –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π push/scrape               |
| –ù–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–±–æ—Ä                    | `timestamp(...)`, `changes(...)`           | –ù–∞—Å—Ç—Ä–æ–π —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã         |
| Push-–ø—Ä–æ–±–ª–µ–º—ã (`vmagent`, `gateway`) | `up{}`, –ª–æ–≥–∏                                | –£–±–µ–¥–∏—Å—å –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞|
| –ü—Ä–æ–±–ª–µ–º—ã VictoriaMetrics             | `vm_ingest_rows_dropped_total`             | –£–≤–µ–ª–∏—á—å –ª–∏–º–∏—Ç—ã, –ø—Ä–æ–≤–µ—Ä—å –¥–∏—Å–∫ –∏ ingestion|
| –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana                    | `Min step`, `fill()`                        | –ù–∞—Å—Ç—Ä–æ–π —è–≤–Ω–æ —à–∞–≥ –∑–∞–ø—Ä–æ—Å–∞                |

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –ø–æ–º–æ—á—å —Ç–µ–±–µ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π PromQL-–∑–∞–ø—Ä–æ—Å –∏–ª–∏ –¥–∞—Ç—å —à–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è VictoriaMetrics/vmagent. –•–æ—á–µ—à—å?


***


–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –î–∞–≤–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å ¬´—Ä–≤–∞–Ω—ã–º–∏¬ª –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ `alba_KdbConnectionService_waitPoolTime_seconds_max` –≤ Grafana —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º VictoriaMetrics.

---

## üîç –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö

### 1.1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Query Inspector –≤ Grafana

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –º–µ—Ç—Ä–∏–∫–∏.
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏ (‚öôÔ∏è) –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –ø–∞–Ω–µ–ª–∏ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ **"Inspect" ‚Üí "Query Inspector"**.
3. –í –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –æ–∫–Ω–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–π –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–ª—É—á–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç.
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç–≤–µ—Ç–µ –Ω–∞ —Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏, –≥–¥–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –Ω–∞–±–ª—é–¥–∞—é—Ç—Å—è —Ä–∞–∑—Ä—ã–≤—ã.

### 1.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Explore –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è PromQL-–∑–∞–ø—Ä–æ—Å–æ–≤

1. –í –ª–µ–≤–æ–º –º–µ–Ω—é Grafana –≤—ã–±–µ—Ä–∏—Ç–µ **"Explore"**.
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, VictoriaMetrics).
3. –í –ø–æ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –≤–≤–µ–¥–∏—Ç–µ:
   ```promql
   alba_KdbConnectionService_waitPoolTime_seconds_max
   ```

4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –ø–µ—Ä–∏–æ–¥—ã —Å —Ä–∞–∑—Ä—ã–≤–∞–º–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.
5. –ù–∞–∂–º–∏—Ç–µ **"Run Query"** –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–∏ –ø–µ—Ä–∏–æ–¥—ã.

---

## üõ†Ô∏è –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã–º —Å–±–æ—Ä–æ–º –º–µ—Ç—Ä–∏–∫.

1. –í Explore –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å:
   ```promql
   rate(alba_KdbConnectionService_waitPoolTime_seconds_max[5m])
   ```

2. –ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã, —ç—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —á–∞—Å—Ç–æ—Ç–æ–π —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö.

---

## ‚öôÔ∏è –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `vmagent` –∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `vmagent` –∏–ª–∏ `prometheus.yml` –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
   ```yaml
   scrape_interval: 15s
   scrape_timeout: 10s
   ```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç—ë—Ä –º–µ—Ç—Ä–∏–∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –æ–ø—Ä–æ—Å–∞.

---

## üñºÔ∏è –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Grafana

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Å –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏, Grafana –º–æ–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ä–∞–∑—Ä—ã–≤—ã –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –º–µ—Ç—Ä–∏–∫–∏.
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ —à–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏ (‚öôÔ∏è) –∏ –≤—ã–±–µ—Ä–∏—Ç–µ **"Edit"**.
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **"Display"**.
4. –í —Ä–∞–∑–¥–µ–ª–µ **"Null value"** –≤—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é **"Connected"**, —á—Ç–æ–±—ã —Å–æ–µ–¥–∏–Ω—è—Ç—å —Ç–æ—á–∫–∏ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. ([Strange "gaps" in graphs - Grafana Labs Community Forums](https://community.grafana.com/t/strange-gaps-in-graphs/41314?utm_source=chatgpt.com))

---

## ‚úÖ –®–∞–≥ 5: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `keep_last_value` –≤ VictoriaMetrics

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ VictoriaMetrics, –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `keep_last_value()` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏–∑–≤–µ—Å—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º. ([VictoriaMetrics and Grafana - Sometimes Missing Data - Configuration](https://community.home-assistant.io/t/victoriametrics-and-grafana-sometimes-missing-data/525023?utm_source=chatgpt.com))

1. –í Explore –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å:
   ```promql
   keep_last_value(alba_KdbConnectionService_waitPoolTime_seconds_max)
   ```

2. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∏–∑–±–µ–∂–∞—Ç—å —Ä–∞–∑—Ä—ã–≤–æ–≤ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ, –æ—Ç–æ–±—Ä–∞–∂–∞—è –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–µ—Ä–∏–æ–¥—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## üìä –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ VictoriaMetrics

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ VictoriaMetrics –Ω–µ —Ç–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑-–∑–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

1. –í Explore –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã:
   - ```promql
     vm_ingest_rows_dropped_total
     ```
   - ```promql
     vm_ingest_rows_per_second
     ```
2. –ï—Å–ª–∏ `vm_ingest_rows_dropped_total` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —ç—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø–∏—Å–∏.

---

## üìå –†–µ–∑—é–º–µ

| –ü—Ä–æ–±–ª–µ–º–∞                             | –†–µ—à–µ–Ω–∏–µ                                                                 |
|-------------------------------------|--------------------------------------------------------------------------|
| –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ                   | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –º–µ—Ç—Ä–∏–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö                      |
| –ù–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫             | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π `scrape_interval` –≤ `vmagent` –∏–ª–∏ `prometheus.yml` |
| –†–∞–∑—Ä—ã–≤—ã –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –≤ Grafana         | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ü–∏—é **"Connected null values"** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–∞–Ω–µ–ª–∏       |
| –ü—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö VictoriaMetrics    | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ `vm_ingest_rows_dropped_total` –∏ `vm_ingest_rows_per_second` |

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `vmagent`, `prometheus.yml` –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç—ë—Ä–æ–≤ –º–µ—Ç—Ä–∏–∫, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É. 


***



