## Короткий ответ

* **`metadata.annotations.description`** — обычное аннотирование ресурса. Любая пара ключ-значение в `metadata.annotations` проходит в Kubernetes; Gatekeeper тоже хранит её как «декорацию». Библиотека готовых шаблонов использует именно такое поле для краткого описания политики.
* Текст, который увидит арендатор-автор «плохого» `Gateway`, формируется в блоке **`violation`** вашего Rego-кода. Всё, что вы запишете в поле `"msg"`, будет вставлено Kubernetes-API в строку отказа (kubectl покажет её сразу после *Error from server … denied the request*).
* Хотите подробней?—составьте сообщение динамически через `sprintf`, добавьте переносы строк `\n` или включите список деталей. Пример ниже.

---

## 1  Поле `metadata.annotations.description`

* Аннотации — это «неограниченный» ключ-значение словарь; схема `ConstraintTemplate` их никак не валидирует. Поэтому комментировать или удалять `description` можно без последствий: на работу веб-хука это не вли­я­ет.
* Gatekeeper-CLI (`kubectl get constrainttemplates -o wide`) выводит только имя/версию, так что поле служит **документации людям** и попадает, например, в авто-генерированный сайт Policy-Library.

---

## 2  Как сделать сообщение понятнее арендаторам

### 2.1 Базовая форма (то, что вы уже используете)

```rego
violation[{ "msg": msg }] {
  ...
  msg := sprintf(
    "Wildcard host %q запрещён. Разрешён только формат *.TENANT.<suffix>.",
    [host])
}
```

*Первая строка отказа из Kubernetes будет примерно такой:*

```
Error from server (denied by tenant-wildcard-hosts): 
Wildcard host "*.bob.hc.intranet.corp.com" запрещён. ...
```

### 2.2 Добавляем подробности

```rego
violation[{ "msg": msg, "details": {"invalid_host": host, "allowed": input.parameters.domainSuffixes} }] {
  host := server.hosts[_]
  startswith(host, "*.")
  not valid_host(host)

  msg := sprintf("%q не подходит.\nРазрешены только шаблоны: %v.\n" ++
                 "Попробуйте: *.TENANT.%s",
                 [host, input.parameters.domainSuffixes, input.parameters.domainSuffixes[0]])
}
```

* Что меняется:

  * `\n` создаёт многострочный вывод (kubectl покажет его как одну строку, но с видимыми переносами; в UI/логах они отображаются корректно).
  * Ключ `details` **не выводится в отказе**, но появится в статусе аудита (`kubectl get k8stenantwildcardhost ... -o yaml`) — удобно для разборов инцидентов.

### 2.3 Несколько разных проверок

Создайте несколько правил `violation[...]` — Gatekeeper отправит **все** сообщения, соединённые точкой с запятой. Пример из официального шаблона `k8srequiredlabels` так и делает.

---

## 3  Памятка о размере и производительности

| Ограничение              | Значение                                                                                                                            |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------- |
| Максимальный объём `msg` | ≈ 4 KiB (ограничение admission-review)                                                                                              |
| Символы                  | Можно UTF-8, kubectl и журналы отрендерят правильно                                                                                 |
| Время на форматирование  | Не влияет заметно: всё выполняется внутри одного вызова OPA; избегайте тяжёлых `count()`/`substr()` в цикле, если сообщение длинное |

---

## 4  Итого

* `metadata.annotations.description` — чисто информационное поле; оставляйте или убирайте без опасений.
* Чтобы «подсказать» арендатору, **запишите подробный текст в `msg`** или храните структуру в поле `details`. Всё, что попало в `msg`, Kubernetes покажет напрямую в диалоге отказа, а `details` пригодится для поддержки и аудита.

Так вы получите и дружелюбное сообщение для пользователей, и полноценную служебную информацию внутри кластера.
