208_01_

---

# 4. Operate - what and why

* **Dashboards. Grafana links + Notes "How to read a Dashboard"**
  Links to dashboards (usually Grafana) and a short note on **how** to interpret the graphs: which panels are key, which thresholds are normal, which indicate incidents.

* **Alerts**
  General list of alerts for the component.

* **Rules (name, expr, severity, page or ticket)**
  Table of alert rules:

  * `name` - rule name;
  * `expr` - expression (usually **PromQL**) for triggering;
  * `severity` - criticality (critical / warning / info);
  * `page or ticket` - action: page on-call (PagerDuty, Opsgenie, etc.) or create ticket (Jira, ServiceNow).
    *Example:*
    `KubeAPIErrorRateHigh` - `rate(apiserver_request_total{code=~"5.."}[5m]) > 0.05`, severity=`critical`, action=`page`.

* **Runbooks. Links per alert**
  For **each** alert - link to a runbook: step-by-step instructions (checks, commands, criteria for "fixed").

* **Common Ops: scale, rotate certs/keys, drain nodes, webhooks stuck, CRD skew**
  Common operational tasks with short procedures:

  * **scale** - how to scale Deployment/StatefulSet (via HPA, manually with `kubectl scale`, limits);
  * **rotate certs/keys** - rotation of TLS certs/keys (source, expiry, who must restart);
  * **drain nodes** - safe node eviction (`kubectl drain`, tolerations, PodDisruptionBudget);
  * **webhooks stuck** - what to do if admission/mutating **webhook** hangs and blocks Pod creation;
  * **CRD skew** - version drift of **CRDs** across clusters/controllers and consequences (validation, stored versions).

* **Incident triage: symptoms -> checks -> actions -> verify -> comms -> postmortem**
  Standard incident funnel:

  1. **symptoms** - what the problem looks like (user impact, metrics);
  2. **checks** - quick checks (SLO, logs, `kubectl get`, dependencies health);
  3. **actions** - allowed mitigations / rollbacks / feature toggles;
  4. **verify** - how to confirm the fix;
  5. **comms** - who and how to notify (status channel, incident room, update template);
  6. **postmortem** - structured incident review (timeline, root cause, RCA actions).

* **Maintenance (upgrade SOPs, cert rotations, webhook timeouts, GC & compaction)**
  Regular maintenance:

  * **upgrade SOPs** - standard operating procedures for upgrades (versions, order, rollback plan, maintenance window);
  * **cert rotations** - planned certificate rotations;
  * **webhook timeouts** - timeout settings to avoid API blocking;
  * **GC & compaction** - garbage collection/compaction (for **etcd**, image registry, log storage).

* **Capacity & Cost (cardinality, etcd objects, images count, storage footprint)**
  Capacity and cost management:

  * **cardinality** - monitoring metric cardinality (label explosion in Prometheus);
  * **etcd objects** - how many objects are stored in **etcd** (limits, growth);
  * **images count** - number of images/tags in registry (cleanup, retention);
  * **storage footprint** - disk usage (PVs, images, backups).

* **Security Ops (CVE handling, image signing/verif, policy updates)**
  Operational security practices:

  * **CVE handling** - triaging and patching vulnerabilities, timelines;
  * **image signing/verif** - container image signing and verification (cosign/Notary, admission enforcement);
  * **policy updates** - keeping security policies updated (OPA/Gatekeeper/Kyverno, Pod Security, NetworkPolicy).

* **DR/Backup (what's backed up, frequency, restore test cadence & RTO/RPO proof)**
  Disaster recovery & backups:

  * what is backed up (etcd, manifests/Helm charts, secrets, PV snapshots, image registry);
  * **frequency** - backup schedule;
  * **restore test cadence** - how often we test restores;
  * **RTO/RPO proof** - evidence of meeting **RTO/RPO** targets (measurements, reports).

---

# 5. Appendices - what to include

* **Port matrix, Config parameters table, Known issues, FAQ, Glossary, ADR links**

  * **Port matrix** - table of ports/protocols/directions and purpose;
  * **Config parameters table** - all tunable parameters with defaults and valid ranges;
  * **Known issues** - known limitations/bugs and workarounds;
  * **FAQ** - frequently asked questions with short answers;
  * **Glossary** - terminology;
  * **ADR links** - references to **Architecture Decision Records** (history of major design decisions).

---

## Abbreviations & Terms (quick glossary)

* **Grafana** - monitoring and dashboard system.
* **Alert / Rule** - trigger condition for an alert (Prometheus -> Alertmanager).
* **PromQL (expr)** - Prometheus Query Language expression.
* **Runbook** - operational guide for handling alerts.
* **Ops** - operations / running the system.
* **Webhook** - external HTTP callback (admission/mutating/validating) in Kubernetes API.
* **CRD (CustomResourceDefinition)** - definition of custom Kubernetes objects.
* **SOP (Standard Operating Procedure)** - documented operational procedure.
* **GC (Garbage Collection)** - cleanup of unused objects/data.
* **Compaction** - shrinking storage (e.g. etcd), defragmenting and removing old revisions.
* **etcd** - distributed KV store backing Kubernetes state.
* **Cardinality (of metrics)** - number of unique label combinations; high cardinality = heavy queries/memory.
* **CVE (Common Vulnerabilities and Exposures)** - standardized list of known vulnerabilities.
* **Image signing / verification** - cryptographic signing of container images and verifying before deployment.
* **Policy (OPA/Gatekeeper/Kyverno)** - policy-as-code for manifests/compliance.
* **DR (Disaster Recovery)** - recovery after catastrophic failure.
* **Backup** - snapshot of data.
* **RTO (Recovery Time Objective)** - maximum acceptable downtime.
* **RPO (Recovery Point Objective)** - maximum acceptable data loss (how old backups can be).
* **Comms** - communications during incident.
* **Postmortem / RCA** - after-incident analysis / root cause analysis.
* **ADR (Architecture Decision Record)** - short record of an architecture decision: context, options, choice, consequences.
* **Port matrix** - table of ports/protocols/ACLs.
* **Storage footprint** - actual disk usage (by components).
* **Cadence** - frequency/regularity (of tests, reports, syncs).

---

## Mini examples

* **Alert rule (YAML):**

```yaml
groups:
- name: api-server.rules
  rules:
  - alert: KubeAPIErrorRateHigh
    expr: rate(apiserver_request_total{code=~"5.."}[5m]) > 0.05
    for: 10m
    labels:
      severity: critical
    annotations:
      summary: "API server 5xx error rate >5% (10m)"
      runbook_url: https://docs.example/runbooks/kubeapiserver-5xx
```

* **Runbook fragment:**

1. Check logs: `kubectl -n kube-system logs deploy/kube-apiserver -f --tail=200`
2. Check webhooks: `kubectl get validatingwebhookconfigurations`
3. Mitigation: temporarily increase webhook timeout to 10s;
4. Verification: error rate < 1%;
5. Comms: update in #incident-channel;
6. Postmortem - within 48h.

* **Port matrix example:**
  \| Source | Dest | Proto/Port | Purpose | Direction |
  \|---|---|---|---|---|
  \| Node | Kube-API | TCP/6443 | Kubernetes API | Egress |
  \| Pods | etcd | TCP/2379 | State store | Egress |

---
